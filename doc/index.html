<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html" />
<link rel=stylesheet href="main.css" type="text/css" />
<head><title>Randoop Manual</title></head>

<body>
<h1>Randoop Manual</h1> <!-- omit from toc -->


<!-- start toc.  do not edit; run html-update-toc instead -->
    <ul>
      <li><a href="#intro">Introduction</a>
        <ul>
          <li><a href="#vision">Vision, successes and challenges</a></li>
        </ul></li>
      <li><a href="#getting_randoop">Getting Randoop</a></li>
      <li><a href="#running_randoop">Running Randoop</a></li>
      <li><a href="#getting_help">Getting help</a></li>
      <li><a href="#generating_tests">Generating tests</a>
        <ul>
          <li><a href="#error_revealing_tests">Error-revealing Tests</a></li>
          <li><a href="#regression_tests">Regression tests</a></li>
        </ul></li>
      <li><a href="#cutomize">Customizing Randoop's behavior to your application</a>
        <ul>
          <li><a href="#checkrep">Specifying representation invariant ("checkRep") methods</a></li>
          <li><a href="#primitives">Specifying additional primitive values</a></li>
        </ul></li>
    </ul>
<!-- end toc -->

 
<h2 id="intro">Introduction</h2>

<p> Writing tests is a difficult and time-consuming activity, and yet
it is a crucial part of good software engineering. Randoop
automatically generates unit tests for Java classes. For example, here
is a <a href="http://www.junit.org" rel="nofollow">JUnit</a> test case
generated by Randoop that reveals an error in Sun&#x27;s JDK (comments
added by hand): </p>

<pre class="code">

  // This test shows that the JDK collection classes
  // can create an object that is not equal to itself. 
  public static void test1() {

    LinkedList list = new LinkedList();
    Object o1 = new Object();
    list.addFirst(o1);

    // A TreeSet is an ordered collection. According to Sun's
    // API, this constructor call should throw a ClassCastException
    // because the list element is not Comparable. But
    // the constuctor silently (and problematically) accepts the list.
    TreeSet t1 = new TreeSet(list);
  
    Set s1 = Collections.synchronizedSet(t1);
  
    // At this point, we have successfully created a set (s1)
    // that violations reflexivity of equality: it is not equal
    // to itself! This assertion fails at runtime on Sun&#x27;s JDK.
    Assert.assertTrue(s1.equals(s1));
  }
</pre>

<p>This tutorial will help you get started with Randoop by describing
the kinds of tests it generates, its command-line interface and
walking you examples of using the tool to generate unit
tests. </p>

<h3 id="vision">Vision, successes and challenges</h3>

<p>The vision of our work is a testing
system that at the push of a button creates a solid set of tests that
provide good coverage of arbitrary classes, with no manual effort on
your part. Randoop is a step in this direction and it has had many
successful applications, especially with library classes (such as
java.util). Randoop is used at companies like ABB and Microsoft, and
on open-source
projects. </p>


<p><img src="http://people.csail.mit.edu/cpacheco/lightbulb.jpg"
width="50"> Like any tool attempting to solve a challenging problem,
there are also many areas for improvement. Below, we will point out
potential limitations and opportunities for improvement for Randoop,
indicated with the lightbulb image on the left. Also, take a look at
our <a href="/p/randoop/wiki/ProjectIdeas">ProjectIdeas</a> page if
you are interested to contributing to Randoop or the field of
automated test generation. </p>

<h2 id="getting_randoop">Getting Randoop</h2>

<p>You have three
options: </p>

<ul><li><strong>(Easiest)</strong> If you are interested
only in using Randoop, the quickest way to get started is downloading
the file <tt>randoop.jar</tt> under
the <a href="http://code.google.com/p/randoop/downloads/list"
rel="nofollow">Downloads</a> tab. After you do this, follow the
instructions in the next
section. </li></ul><ul><li><strong>(Easy)</strong> If you want to use
Randoop and are also interested in inspecting or compiling the source
code, you can download the file <tt>randoop.zip</tt> under
the <a href="http://code.google.com/p/randoop/downloads/list"
rel="nofollow">Downloads</a> tab. This archive contains, in addition
to <tt>randoop.jar</tt>, the source code for the tool and accompanying
libraries. </li></ul><ul><li><strong>(Advanced)</strong> Finally, you
can get the entire project repository contents, which includes system
tests for Randoop and subject programs for experiments. Look at
the <a href="http://code.google.com/p/randoop/source/checkout"
rel="nofollow">Source</a> tab for instructions on obtaining the
repository. </li></ul>

<h2 id="running_randoop">Running Randoop</h2>

<p>The easiest way to run Randoop is by adding to your
classpath the file <tt>randoop.jar</tt> provided with the Randoop
distribution. Run Randoop by invoking its main
class <tt>randoop.main.Main</tt>. Randoop&#x27;s interface is
command-based: it expects a specific command as the first argument,
followed by command arguments. (Currently, Randoop includes only two
commands, <tt>help</tt> and <tt>gentests</tt>.) If you run Randoop
without any arguments, you will get an informational
screen: </p>

<pre class="code">
% java -ea -classpath randoop.jar randoop.main.Main help

Randoop for Java version 1.3.

Randoop  is a command-line tool that creates unit tests for Java.
It accepts one of the commands listed below. For more information,
please visit http://code.google.com/p/randoop/

Type &#x27;help&#x27; followed by a command name to see documentation.

Commands:

gentests -- Generates unit tests for a set of classes.
help -- Displays a help message for a given command.</pre>

<!-- <h2 id="cutomize">Key command-line options</h2> -->

<!-- <h3 id="usethreads">Speeding up generation with <tt>usethreads</tt></h3> -->

<!-- Randoop can execute a generated test in two modes: -->

<!-- <ul> -->
<!--   <li> <b>Execute each test in a separate thread.</b> If your code -->


<!-- In the first mode, every time Randoop generates a new test, it creates -->
<!-- a new thread to execute the test in. The main advantage of doing this -->
<!-- is that Randoop can kill any test that is taking too long to finish -->
<!-- executing by killing its corresponding thread; without the option, a -->
<!-- test resulting in non-terminating behavior will cause Randoop to -->
<!-- hang. The main disa -->

<!-- By default, Randoop runs with the option <tt>usethreads</tt> set -->
<!-- to <tt>true</tt>. This means -->

<p>We recommend always giving the <tt>-ea</tt> (enable assertions)
option to java when running Randoop: if something goes wrong and you
send us an error report, we will be able better to help you diagnose
the cause of the problem.</p>


<h2 id="getting_help">Getting help</h2>

<p>There are three sources for getting help on Randoop:</p>

<ul><li><strong>Manual</strong>: what you are currently reading. </li><li><strong>Randoop&#x27;s <tt>help</tt> command</strong>. To get help on command-line options, use Randoop&#x27;s <tt>help</tt> command. In particular, to get help on command-line options for test generation, type: </li><pre class="code">java -classpath randoop.jar randoop.main.Main help gentests</pre><li><strong>Mailing list</strong> If you don&#x27;t find your question answered, email <tt>randoop-developers@googlegroups.com</tt> with your question. If you have discovered a problem with Randoop, submit an issue to the <a href="http://code.google.com/p/randoop/issues/list" rel="nofollow">Issues list</a>. </li></ul><p>Randoop will output the syntax, description and options related to the <tt>gentests</tt> command, which generates tests. </p>

<h2 id="generating_tests">Generating tests</h2>

<p>Randoop can be used to generate two kinds of unit
tests. <i>Error-revealing tests</i> are tests that fail when executed,
indicating a potential error in one or more classes under
test. <i>Regression tests</i> are tests that pass when executed, and
can be used to augment a regression test suite. The following sections
describe error-revealing and regression tests in more detail and how
you can use Randoop to generate them. </p>

<p>Imagine we want to generate tests for the
class <tt>java.util.Collections</tt>, a utility class that defines
several methods for manipulating collections. </p>

<p>The first important thing to keep in mind is that <strong>Randoop
will only generate tests using classes you specify.</strong> In order
to effectively test Collections, You should probably also specify some
helper classes, including classes that generates collections. For this
example, we will add <tt>java.util.TreeSet</tt> to the mix. </p>

<p>Invoke Randoop as follows (all in a single line): </p>

<pre class="code">java -classpath randoop.jar randoop.main.Main gentests --testclass=java.util.TreeSet --testclass=java.util.Collections --timelimit=60</pre><p>Alternatively, you can create a file that lists the names of the classes under test, and use the <tt>--classlist</tt> option: </p>

<pre class="code">java -classpath randoop.jar randoop.main.Main gentests --classlist=myclasses.txt --timelimit=60</pre><p>Where the contents of <tt>myclasses.txt</tt> are as follows. </p>

<pre class="code">java.util.Collections
java.util.TreeSet</pre><p>After 60 seconds, Randoop stops generating tests. The last thing Randoop prints out is the name of the JUnit files containing the tests it generated. You should see a message similar to the following: </p>

<pre class="code">Created file: my/home/directory/RandoopTest0.java
Created file: my/home/directory/RandoopTest.java
done.</pre><p>The main test driver is in class <tt>RandoopTest</tt>. You can now compile and run the tests. Don&#x27;t forget to include randoop.jar in the classpath when you compile and run the tests. In this example, you should also add the current directory (&quot;.&quot;) when you run the tests. </p>

<pre class="code">javac -classpath randoop.jar RandoopTest*.java
java -classpath .:randoop.jar junit.textui.TestRunner RandoopTest</pre><p>JUnit will execute the generated tests. Most will pass, and some will fail. The next section describes the kinds of tests that Randoop generates, and the reason why they may fail. </p>

<h3 id="error_revealing_tests">Error-revealing Tests</h3>

<p>Failing tests show a specific use of a class under test that leads
to a runtime violation of a contract; a <i>contracts</i> is just a
property that a class, object or method is expected to preserve,
e.g. an object invariant or a method postcondition. Contract
violations suggest errors in the code. For example, the test shown in
the <a href="/p/randoop/wiki/UserManual#Introduction">Introduction</a>
represents a violation of <i>reflexivity of equality</i>, an expected
property of Java objects stating that for every
object <tt>o</tt>, <tt>o.equals(o)</tt> should
return <tt>true</tt>. </p>

<pre class="code">// This test shows that the JDK collection classes
// can create an object that is not equal to itself.
public static void test1() {

  LinkedList list = new LinkedList();
  Object o1 = new Object();
  list.addFirst(o1);

  // A TreeSet is an ordered collection. According to Sun&#x27;s
  // API, this constructor call should throw a ClassCastException
  // because the list element is not Comparable. But
  // the constuctor silently (and problematically) accepts the list.
  TreeSet t1 = new TreeSet(list);

  Set s1 = Collections.synchronizedSet(t1);

  // At this point, we have successfully created a set (s1)
  // that violations reflexivity of equality: it is not equal
  // to itself! This assertion fails at runtime on Sun&#x27;s JDK.
  Assert.assertTrue(s1.equals(s1));
}</pre><p><img src="http://people.csail.mit.edu/cpacheco/lightbulb.jpg" width="50"> The test shown above is nicely succint: it shows a small number of method calls leading up to the assertion violation. Because Randoop&#x27;s generation is random, the actual test revealing the error can be significantly longer, and contain many &quot;random&quot; calls leading up to the violation. An older version of Randoop used to have a <i>minimizer</i> built in, i.e. a module that attempted to reduce the number of calls in a failing test to ease debugging. The current version of the tool does not have a minimizer -- but we are hoping to implement it for the next release. </p>

<p>This test shows a scenario that makes it possible to create a <tt>TreeSet</tt> that violates reflexivity of equality. Test test reveals an error in the <tt>TreeSet</tt> constructor, which does not properly check its arguments (and possibly a second error in the <tt>TreeSet.equals</tt> method, which should always check if its argument is the same object as itself and return <tt>true</tt> in such a case). </p>

<h4 id="kinds_of_errors">What kinds of errors does Randoop check for?</h4>  <!-- omit from toc -->

<p>Currently, Randoop checks for a small set of contracts: </p>

<ul>


<li><i>Equals to null:</i> <tt>o.equals(null)</tt> should return <tt>false</tt> </li>
<li><i>Reflexivity of equality:</i> <tt>o.equals(o)</tt> should return <tt>true</tt> </li>
<li><i>Symmetry of equality:</i> <tt>o1.equals(o2)</tt> implies <tt>o2.equals(o1)</tt> </li>
<li><i>Equals-hashcode:</i> If <tt>o1.equals(o2)==true</tt>, then <tt>o1.hashCode() == o2.hashCode()</tt> </li>
<li><i>No null pointer exceptions:</i> No <tt>NullPointerException</tt> is thrown if no <tt>null</tt> inputs are used in a test.</li>
</ul><p>

<img src="http://people.csail.mit.edu/cpacheco/lightbulb.jpg"
width="50"> The set of contracts that Randoop checks is relatively
small; we wanted to be conservative and only check for contracts whole
violation is highly likely to indicate an error. A future version of
the tool should let the user specify more contracts to check by
writing a special &quot;contract-checking&quot; class. </p>

<h3 id="regression_tests">Regression tests</h3>

<p>Most of the tests that Randoop generates will probably pass. They
are regression tests: they record the current behavior of the classes
under test. Regression tests are useful because they can alert you in
the future if you make a change to your code that changes the external
behavior of the classes. Here is an example of a regression test for
the TreeSet<a href="/p/randoop/w/edit/TreeSet">?</a> class we
generated tests for in the previous section. </p>

<pre class="code">// This test passes when executed
public void test10() throws Throwable {

  java.util.TreeSet var0 = new java.util.TreeSet();
  java.lang.Short var1 = new java.lang.Short((short)100);
  boolean var2 = var0.contains(var1);
    
  // Regression assertion (captures the current behavior of the code)
  assertTrue(var2 == false);
}</pre><p>This test will pass when you run it right after executing it. But notice that it captures an important behavior of the method TreeSet<a href="/p/randoop/w/edit/TreeSet">?</a>.contains: it returns false if the set is empty. If later, as the developers of this class, we introduced an error that caused contains to return true on an empty set, the test would fail and thus alert us to the error. </p>

<h2 id="cutomize">Customizing Randoop's behavior to your application</h2>

<h3 id="checkrep">Specifying representation invariant ("checkRep") methods</h3>

A representation invariant method checks that a class's internal
representation satisfies expected properties. For example, a rep
invariant method for a sorted list data structure may check that the
elements in the list are indeed sorted; a rep invariant method for a
balanced binary tree may check that the tree is balanced, etc.

<p>

You can tell Randoop that some methods in your classes under test are
rep invariant methods, and Randoop will call these methods on objects
of the appropriate type, outputting violations of the rep invariant as
failing unit tests. To tell Randoop that a method in a class under
test is a rep invariant method, add the <code>@CheckRep</code>
annotation to the method declaration (don't forget to <code>import
randoop.*</code>).

<p>

A method annotated with <code>@CheckRep</code> must have one of two
allowed signatures:

<p>

<ul>

<li>A public instance method with no arguments and return
type <b>boolean</b>. In this case, Randoop will interpret a return
value of <code>true</code> as the rep invariant being satisfied, and a
return value of <code>false</code> <i>or</i> an exception escaping the
method as the rep invariant being violated.

<p>

<li>A public instance method with no arguments and return
type <b>void</b>. In this case, Randoop will interpret a normal return
(no exceptions) as the rep invariant being satisfied, and a an
exception escaping the method as the rep invariant being violated.

</ul>

<h3 id="primitives">Specifying additional primitive values</h3>

By default, Randoop uses the following pool of primitive values as
inputs to methods:

<ul>
  <li><tt>byte</tt>: <tt>-1</tt>, <tt>0</tt> <tt>1</tt>,  <tt>10</tt>, <tt>100</tt>
  <li><tt>short</tt>: <tt>-1</tt>, <tt>0</tt> <tt>1</tt>,  <tt>10</tt>, <tt>100</tt>
  <li><tt>int</tt>: <tt>-1</tt>, <tt>0</tt> <tt>1</tt>,  <tt>10</tt>, <tt>100</tt>
  <li><tt>long</tt>: <tt>-1</tt>, <tt>0</tt> <tt>1</tt>,  <tt>10</tt>, <tt>100</tt>
  <li><tt>float</tt>: <tt>-1</tt>, <tt>0</tt> <tt>1</tt>,  <tt>10</tt>, <tt>100</tt>
  <li><tt>double</tt>: <tt>-1</tt>, <tt>0</tt> <tt>1</tt>,  <tt>10</tt>, <tt>100</tt>
  <li><tt>char</tt>: <tt>'#', </tt>' '</tt>, <tt>'4'</tt>, <tt>'a'</tt>
  <li><tt>java.lang.String</tt>: <tt>""</tt>, <tt>"hi!"</tt>
</ul>

<p>This is the initial set of <i>seed</i> values used by Randoop: in
addition to the above values, any primitive value returned at runtime
from a method call under test may be later used as input to another
method call.</p>

<p>To explicitly specify additional seed values, use
the <tt>@TestValue</tt> annotation as follows:</p>

<ol>

  <li> Create a <b>public</b> class <i>C</i>, and import <tt>randoop.*</tt>.

  <li> Declare one more more fields in <i>C</i> that hold the
       values you want to seed. Each field should:

    <ul>
      <li> include the <tt>@TestValue</tt> annotation,
      <li> be declared <b><tt>public</tt></b> and <b><tt>static</tt></b>,
      <li> be of a primitive (or <tt>String</tt>) type, or an array of primitives or <tt>String</tt>s, and
      <li> be initialized to contain one or more seed values.
    </ul>

  <li> Include the class you created in the list of classes given to Randoop to test.
</ol>

<p>Alternatively, you can simply add a <tt>@TestValue</tt> annotation
to a field in one of your classes under test, as long as it adheres to
the above requirements.</p>

<p>Below is an example helper class that demonstrates the use of the
@TestValue annotation. For Randoop to use the primtive values
described in the class, you would add this class to the list of
classes under test
(e.g. via the option <tt>--testclass=example.TestValueExamples</tt>).</p>

<pre class="code">
  package example;
  import randoop.*;

  public class TestValueExamples {

    @TestValue
    public static int i = 0;

    @TestValue
    public static boolean b = false;

    @TestValue
    public static byte by = 3;

    @TestValue
    public static char c = 'c';

    @TestValue
    public static long l = 3L;

    @TestValue
    public static float f = (float) 1.3;

    @TestValue
    public static double d = 1.4;

    @TestValue
    public static String s1 = null;

    @TestValue
    public static String s2 = "hi";

    @TestValue
    public static int[] a1 = new int[] { 1, 2, 3 };

  }
</pre>

<!-- <h2 id="faq">FAQ: Frequently Asked Questions (and common problems)</h2> -->
<!-- <h3 id="q1">How do I determine what "helper" classes to add?</h3> -->
<!-- <h3 id="q2">Randoop generates many tests that look similar</h3> -->
<!-- <h3 id="q3">Randoop does not output any tests</h3> -->
<!-- <h3 id="q3">Randoop is hanging</h3> -->

</body>
</html>
